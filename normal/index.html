<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Task management</title>
  <meta name="description" content="Polished task manager UI with accessible colors, smoother animations, and improved UX." />

  <style>
    :root{
      --primary:#7c3aed; /* slightly cooler purple */
      --primary-600:#6d28d9;
      --primary-100:#ede9fe;
      --bg-1:linear-gradient(135deg,#fbf8ff 0%, #f1eefc 100%);
      --glass:rgba(255,255,255,0.6);
      --card:rgba(255,255,255,0.85);
      --muted:#6b7280;
      --text:#0f172a;

      --p-high:#ef4444; --p-medium:#f59e0b; --p-low:#10b981;
      --radius:18px;
      --shadow-lg:0 20px 40px rgba(15,23,42,0.12);
      --shadow-sm:0 6px 16px rgba(15,23,42,0.06);
    }

    @media (prefers-color-scheme:dark){
      :root{
        --bg-1:linear-gradient(135deg,#071029 0%, #0b1020 100%);
        --card:rgba(15,23,42,0.65);
        --glass:rgba(255,255,255,0.04);
        --muted:#94a3b8; --text:#f8fafc;
      }
    }

    /* base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
      background:var(--bg-1); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      display:flex; align-items:center; justify-content:center; padding:28px;
    }

    /* container */
    .panel{
      width:100%; max-width:1100px; border-radius:28px; overflow:hidden; display:grid; grid-template-columns:320px 1fr; gap:0;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.45)); box-shadow:var(--shadow-lg); backdrop-filter:blur(12px);
      border:1px solid rgba(124,58,237,0.06);
    }
    @media(max-width:880px){.panel{grid-template-columns:1fr; max-width:760px}}

    /* sidebar */
    .sidebar{padding:30px 26px; border-right:1px solid rgba(15,23,42,0.04); display:flex; flex-direction:column; gap:22px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:44px; height:44px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:700; color:white; background:linear-gradient(135deg,var(--primary),var(--primary-600)); box-shadow:var(--shadow-sm)}
    .app-title{font-weight:700; font-size:1.05rem}

    .progress{
      margin-top:6px; display:flex; gap:14px; align-items:center; justify-content:center; flex-direction:column
    }
    .prog-wrap{width:140px; height:140px; display:grid; place-items:center}
    /* circular progress is svg-based for crispness */
    .stats{display:flex; gap:12px; width:100%; justify-content:space-between; color:var(--muted); font-size:0.92rem}

    /* main */
    .main{padding:28px 28px 34px; display:flex; flex-direction:column; gap:18px}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .controls{display:flex; gap:10px; align-items:center}

    /* search & filter */
    .search{
      display:flex; align-items:center; gap:10px; background:var(--card); padding:10px 12px; border-radius:14px; box-shadow:var(--shadow-sm); border:1px solid rgba(15,23,42,0.03)
    }
    .search input{border:0; outline:none; background:transparent; width:260px}
    .select{appearance:none; padding:10px 12px; border-radius:12px; border:1px solid rgba(15,23,42,0.05); background:var(--card); cursor:pointer}

    /* input row */
    .input-row{display:flex; gap:12px; align-items:center}
    .task-input{flex:1; padding:14px 16px; border-radius:14px; border:1px solid rgba(15,23,42,0.06); background:transparent; outline:none}
    .select-pri{padding:10px 12px; border-radius:12px}
    .btn{padding:12px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:600}
    .btn-add{background:linear-gradient(90deg,var(--primary),var(--primary-600)); color:white; box-shadow:0 8px 24px rgba(124,58,237,0.18)}

    /* list area */
    .list{overflow:auto; padding-right:8px; display:flex; flex-direction:column; gap:12px}
    .card{display:flex; gap:14px; align-items:center; padding:14px; border-radius:14px; background:var(--card); border:1px solid rgba(15,23,42,0.03); box-shadow:var(--shadow-sm); transition:transform .22s ease, box-shadow .22s ease}
    .card:hover{transform:translateY(-6px); box-shadow:0 18px 36px rgba(2,6,23,0.08)}

    .check{width:36px; height:36px; border-radius:10px; border:2px solid var(--primary); display:grid; place-items:center; cursor:pointer}
    .task-meta{flex:1; display:flex; flex-direction:column}
    .title{font-weight:700; margin-bottom:6px}
    .meta-row{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:.85rem}

    .tag{padding:4px 8px; border-radius:999px; font-weight:700; font-size:.7rem; text-transform:uppercase}
    .tag-high{background:#fff1f2;color:var(--p-high)}
    .tag-medium{background:#fffbeb;color:var(--p-medium)}
    .tag-low{background:#ecfdf5;color:var(--p-low)}

    .actions{display:flex; gap:8px; align-items:center}
    .btn-ghost{background:transparent; border-radius:10px; padding:8px; border:0; cursor:pointer}

    /* done state */
    .done{opacity:0.6}
    .done .title{text-decoration:line-through}

    /* small screen */
    @media(max-width:880px){
      .search input{width:140px}
      .prog-wrap{width:110px;height:110px}
    }
  </style>
</head>
<body>
  <div class="panel" role="application" aria-label="Premium Task Manager">
    <aside class="sidebar">
      <div class="brand">
        <div>
          <div class="app-title">タスク管理</div>
        </div>
      </div>

      <div class="progress" aria-hidden>
        <div class="prog-wrap">
          <!-- svg circular progress for crisp rendering -->
          <svg id="svgProg" viewBox="0 0 36 36" width="140" height="140" aria-hidden>
            <path d="M18 2.0845
                      a 15.9155 15.9155 0 0 1 0 31.831
                      a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#eef2ff" stroke-width="4"></path>
            <path id="progArc" d="" fill="none" stroke="var(--primary)" stroke-width="4" stroke-linecap="round"></path>
            <text id="progText" x="18" y="20.5" font-size="6" font-weight="700" text-anchor="middle" fill="var(--text)"></text>
          </svg>
        </div>
        <div style="text-align:center">
          <div style="font-weight:700">今日の進捗</div>
          <div style="font-size:0.9rem;color:var(--muted)">小さな達成の積み重ね、大事。一番。</div>
        </div>
      </div>

      <div style="margin-top:auto">
        <div class="stats"><div>完了 <b id="doneCount">0</b></div><div>残り <b id="pendingCount">0</b></div></div>
      </div>
    </aside>

    <main class="main">
      <header>
        <div style="display:flex;flex-direction:column">
          <h1 style="margin:0;font-size:1.25rem">My Tasks</h1>
          <div style="font-size:.9rem;color:var(--muted)">タスクを管理</div>
        </div>

        <div class="controls">
          <div class="search" role="search" aria-label="検索">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.5"></circle></svg>
            <input id="q" placeholder="タスクを検索" aria-label="タスク検索">
          </div>

          <select id="filterSelect" class="select" aria-label="フィルター">
            <option value="all">すべて</option>
            <option value="high">優先度：高</option>
            <option value="done">完了のみ</option>
          </select>
        </div>
      </header>

      <div class="input-row" style="margin-top:6px">
        <input id="taskInput" class="task-input" placeholder="新しいタスクを入力... (Enterで追加)" aria-label="タスク入力">
        <select id="priorityInput" class="select-pri" aria-label="優先度">
          <option value="high">高</option>
          <option value="medium" selected>中</option>
          <option value="low">低</option>
        </select>
        <button id="addBtn" class="btn btn-add" aria-label="追加">追加</button>
      </div>

      <section id="list" class="list" aria-live="polite"></section>

    </main>
  </div>

  <script>
    // Improved: use array of tasks, store in localStorage; smaller helper functions
    const STORAGE_KEY = 'v2_tasks_improved';
    let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

    // helpers
    const el = (id)=>document.getElementById(id);

    function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); }

    function uid(){ return Math.floor(Date.now() + Math.random()*1000); }

    function addTask(text, priority='medium'){
      if(!text || !text.trim()) return;
      tasks.push({ id: uid(), text: text.trim(), done:false, priority, created: new Date().toISOString() });
      save(); render();
    }

    function toggleTask(id){
      const t = tasks.find(x=>x.id===id); if(!t) return; t.done = !t.done; save(); render();
    }
    function deleteTask(id){ tasks = tasks.filter(t=>t.id!==id); save(); render(); }

    function renderProgress(){
      const total = tasks.length; const done = tasks.filter(t=>t.done).length;
      const pct = total? Math.round(done/total*100):0;
      // stroke-dasharray for svg arc
      const r = 15.9155; const c = 2*Math.PI*r; const arc = (pct/100)*c;
      const arcPath = `M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831`;
      const prog = document.getElementById('progArc');
      prog.setAttribute('d', arcPath);
      prog.setAttribute('stroke-dasharray', `${arc} ${c-arc}`);
      document.getElementById('progText').textContent = pct + '%';

      el('doneCount').textContent = done;
      el('pendingCount').textContent = total - done;
    }

    function classForPriority(p){ return p==='high'? 'tag-high' : p==='low'? 'tag-low' : 'tag-medium'; }

    function render(){
      const container = el('list');
      const filter = el('filterSelect').value;
      const q = el('q').value.trim().toLowerCase();

      let visible = tasks.slice();
      if(filter==='high') visible = visible.filter(t=>t.priority==='high');
      if(filter==='done') visible = visible.filter(t=>t.done===true);
      if(q) visible = visible.filter(t=>t.text.toLowerCase().includes(q));

      // sort: high > medium > low, then newest first
      const pMap = {high:3, medium:2, low:1};
      visible.sort((a,b)=> (pMap[b.priority]-pMap[a.priority]) || (new Date(b.created)-new Date(a.created)) );

      if(visible.length===0){ container.innerHTML = `<div style="color:var(--muted);padding:24px;border-radius:12px;background:transparent">タスクがありません — 新しいタスクを追加してください。</div>`; renderProgress(); return; }

      container.innerHTML = visible.map(t=>{
        return `
        <article class="card ${t.done? 'done':''}" role="article" aria-label="タスク ${t.text}">
          <button class="check" onclick="toggleTask(${t.id})" aria-pressed="${t.done}">${t.done? '✓':''}</button>
          <div class="task-meta">
            <div class="title">${escapeHtml(t.text)}</div>
            <div class="meta-row">
              <span class="tag ${classForPriority(t.priority)}">${t.priority}</span>
              <span>作成: ${new Date(t.created).toLocaleString()}</span>
            </div>
          </div>
          <div class="actions">
            <button class="btn-ghost" onclick="deleteTask(${t.id})" aria-label="削除">✕</button>
          </div>
        </article>
        `
      }).join('');

      renderProgress();
    }

    // small XSS helper
    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // events
    el('addBtn').addEventListener('click', ()=>{ addTask(el('taskInput').value, el('priorityInput').value); el('taskInput').value=''; el('taskInput').focus(); });
    el('taskInput').addEventListener('keypress', (e)=>{ if(e.key==='Enter'){ addTask(el('taskInput').value, el('priorityInput').value); el('taskInput').value=''; } });
    el('filterSelect').addEventListener('change', render);
    el('q').addEventListener('input', render);

    // keyboard accessibility: focus on input with '/'
    document.addEventListener('keydown', (e)=>{ if(e.key==='/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){ e.preventDefault(); el('q').focus(); } });

    // initial render
    render();

    // expose functions for inline handlers
    window.toggleTask = toggleTask; window.deleteTask = deleteTask;
  </script>
</body>
</html>
